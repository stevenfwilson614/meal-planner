<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Weekly Meal Planner</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      padding: 16px;
      max-width: 520px;
      margin: auto;
    }
    h1 {
      text-align: center;
    }
    .row {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }
    select, button {
      margin-left: 6px;
    }
    a {
      margin-left: 6px;
    }
  </style>
</head>
<body>

<h1>Weekly Meal Planner</h1>
<div id="planner">Loadingâ€¦</div>

<script>
/* ===== CONFIG ===== */
const SHEET_ID = "1S_NX1UxOB38aB-9As9gC8zH4BQMSuONk4g7f5jL8nmE";

/* ===== DATA URLS ===== */
const RECIPES_URL =
  `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=Recipes`;

const PLAN_URL =
  `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=WeeklyPlan`;

/* ===== HELPERS ===== */
function parseGViz(text) {
  const json = text.match(/google\.visualization\.Query\.setResponse\((.*)\);/s);
  return JSON.parse(json[1]).table.rows;
}


/* ===== LOAD DATA ===== */
Promise.all([
  fetch(RECIPES_URL).then(r => r.text()),
  fetch(PLAN_URL).then(r => r.text())
]).then(([recipesText, planText]) => {

  const recipes = parseGViz(recipesText).map(r => ({
    name: r.c[1]?.v || "",
    url: r.c[2]?.v || "",
    tags: (r.c[3]?.v || "").toLowerCase()
  }));

  const plan = parseGViz(planText);
  const container = document.getElementById("planner");
  container.innerHTML = "";

  plan.forEach(r => {
    const day = r.c[0]?.v;
    const meal = r.c[1]?.v;

    const row = document.createElement("div");
    row.className = "row";

    const label = document.createElement("strong");
    label.innerText = `${day} ${meal}`;

    const select = document.createElement("select");
    select.innerHTML = `
      <option value="">Any</option>
      <option value="beef">Beef</option>
      <option value="chicken">Chicken</option>
      <option value="vegetarian">Vegetarian</option>
      <option value="pork">Pork</option>
    `;

    const btn = document.createElement("button");
    btn.innerText = "Generate";

    const result = document.createElement("span");

    btn.onclick = () => {
      const tag = select.value;
      const filtered = t
